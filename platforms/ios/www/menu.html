<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!--Estilos reset para navegadores-->
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <!--Estilos custom para sustituir estilos de materialize-->
    <link rel="stylesheet" href="css/style.css">
    <title>Paradisus</title>

</head>
<body>
    <header>
        <div class="logoletras">
        <a href="index.html" id="removelocal">Cerrar sessi√≥n</a>
          <img src="img/letras-paradisus.png" class="imgLetras"></div>
    </header>
    <section  id="datacontent">
        <div id='carousel-publicidad' class='carousel slide' data-ride='carousel'>
            <div class='carousel-inner' role='listbox' id="data">
            </div>
            <a class='left carousel-control' href='#carousel-publicidad' data-slide='prev'><span class='icon-prev'></span></a>
            <a class='right carousel-control' href='#carousel-publicidad' data-slide='next'><span class='icon-next'></span></a>
        </div>
    </section>
    <div id="hora"></div>
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="js/jquery.mobile.custom.min.js"></script>
    <script src="js/control_events.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <!--<script src="js/fancywebsocket.js"></script>-->
    <script type="text/javascript">

      
      app.initialize();
      //Funciones Temporales
      var fecha=null;

      $("#removelocal").click(function(){
        localStorage.clear();
        alert("limpio");
      });
      $("#datacontent").addClass("json"+localStorage.getItem("MacIOS")+"");
      //Generar Info
      $(document).ready(function(){
        $('#carousel-publicidad').carousel()
        checkAreaId();
        //setInterval('actualizaDom()',1000);
      }); 
          var urlServer="http://192.168.1.124/"; //Url del servidor
          //Ajax que envia la peticon cada que se abra la pagina
          //Setinterval para verificar si hay cambios en la base de datos
          //var inicio =setTimeout(checkAreaId,1000);
          
          function checkAreaId(){
            var macDispositivo =localStorage.getItem("MacIOS");
              $.ajax({
                type: "POST",
                url: urlServer+"serverApparadisus/getData/checkInfo.php",
                data: "macDispositivo="+macDispositivo,
                dataType:"html",
                success: function(data) 
                {
                    var infoJson=JSON.parse(data); //parseo la informacion
                    var mac = infoJson[0].mac;
                    var areaDevice = infoJson[0].area_id;
                    var dataSend={
                      "areaDevice":areaDevice,
                      "fecha"    :fecha
                    }
                    if (areaDevice==1) {
                      /*Ajax para la peticion de informacion general*/
                      $.ajax({
                        async:  true,
                        type: "POST",
                        url: urlServer+"serverApparadisus/getData/checkMultimedia.php",
                        data: dataSend,
                        dataType:"html",
                        success: function(data){
                          var jm=JSON.parse(data);

                          var fechadb= jm.agregado;
                          var lastupdate =localStorage.getItem("update");
                          if(localStorage.getItem("update")===null){
                              window.localStorage.setItem("update",fechadb);
                          }else{}
                          var id_paquete=jm.id_paquetete;

                          if(fechadb>lastupdate){
                            $.ajax({
                              async:true,
                              type: "POST",
                              url: urlServer+"serverApparadisus/getData/diaposJson.php",
                              data:"areaDevice="+localStorage.getItem("Area",areaDevice),
                              dataType:"html",
                              success:function(data){
                                $("#data").html(data);

                                var eliminaFechaLocal =localStorage.removeItem("update");
                                var actualiza =localStorage.setItem("update",fechadb); 
                                alert("Nueva Fecha:"+actualiza);

                              }
                            });

                              
                          }else{
                            console.log("sin cambios");
                          }
                          setTimeout('checkAreaId()',1000);
                          console.log("fechas 1:"+lastupdate);
                          console.log("fechas 2:"+fechadb);
                        }
                      });
                    }else{ 
                    }
                }
              });
          };

          function actualizaDom(){
              var areaDevice=localStorage.getItem("Area");
              var dataSend={
                    "areaDevice":areaDevice,
                    "fecha"    :fecha
                  }
              if (areaDevice==1) {        

                      /*Ajax para la peticion de informacion general*/
                      $.ajax({
                        async:  true,
                        type: "POST",
                        url: urlServer+"serverApparadisus/getData/checkMultimedia.php",
                        data: dataSend,
                        dataType:"html",
                        success: function(data){
                          var jm=JSON.parse(data)
                          var fechadb= jm.agregado;
                          var id_paquete=jm.id_paquetete;

                          if(fecha==null){

                          }else if (fecha >fechadb){
                            console.log("nueva actualizacion");
                          }else{
                            console.log("no hacer nada");
                          }
                        }
                      });
                    }else{ 
                    }
          }

    </script>
</body>
</html>